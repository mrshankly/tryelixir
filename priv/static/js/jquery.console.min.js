// Minified JQuery Console
// Copyright 2010 Chris Done, Simon David Pratt. All rights reserved.
//
// Redistribution and use in source and binary forms, with or without
// modification, are permitted provided that the following conditions
// are met:
//
//    1. Redistributions of source code must retain the above
//       copyright notice, this list of conditions and the following
//       disclaimer.
//
//    2. Redistributions in binary form must reproduce the above
//       copyright notice, this list of conditions and the following
//       disclaimer in the documentation and/or other materials
//       provided with the distribution.
//
// THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
// "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
// LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS
// FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE
// COPYRIGHT HOLDERS OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT,
// INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING,
// BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
// LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER
// CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT
// LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN
// ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE
// POSSIBILITY OF SUCH DAMAGE.
(function(h){var P=!!~navigator.userAgent.indexOf(" AppleWebKit/");h.fn.console=function(e){function v(){d=0;c="";r=0;B=!0;y=h('<div class="jquery-console-prompt-box"></div>');var a=h('<span class="jquery-console-prompt-label"></span>');y.append(a.text(k.continuedPrompt?ba:k.promptLabel).show());a.html(a.html().replace(" ","&nbsp;"));I=h('<span class="jquery-console-prompt"></span>');y.append(I);g.append(y);m()}function Q(a){0!=z.length&&(r+=a,0>r?r=z.length:r>z.length&&(r=0),c=0==r?C:z[r-1],e.historyPreserveColumn?
c.length<d+1?d=c.length:0==d&&(d=c.length):d=c.length,m())}function R(){Q(-1)}function S(){Q(1)}function A(){return d<c.length?(C=c=c.substring(0,d)+c.substring(d+1),!0):!1}function T(){A()&&m()}function J(){var a=jQuery.fn.jquery.split("."),b=parseInt(a[0]);a=parseInt(a[1]);1==b&&6<a||1<b?g.prop({scrollTop:g.prop("scrollHeight")}):g.attr({scrollTop:g.attr("scrollHeight")})}function U(){if("function"==typeof e.commandHandle){B=!1;z.push(c);C="";var a=c;(w=k.continuedPrompt?w?w+("\n"+c):c:void 0)&&
(a=w);a=e.commandHandle(a,function(b){q(b)});k.continuedPrompt&&!w&&(w=c);"boolean"==typeof a?a?q():q("Command failed.","jquery-console-message-error"):"string"==typeof a?q(a,"jquery-console-message-success"):"object"==typeof a&&a.length?q(a):k.continuedPrompt&&q()}}function q(a,b){d=-1;m();if("string"==typeof a)K(a,b);else if(h.isArray(a))for(var f in a){var p=a[f];K(p.msg,p.className)}else g.append(a);v()}function ca(a,b){var f=c;y.remove();q(a,b);k.promptText(f)}function K(a,b){var f=h('<div class="jquery-console-message"></div>');
b&&f.addClass(b);f.filledText(a).hide();g.append(f);f.show()}function u(a){return 0<=d+a&&d+a<=c.length?(d+=a,!0):!1}function D(){return u(1)?(m(),!0):!1}function E(){return u(-1)?(m(),!0):!1}function V(){u(-d)&&m()}function W(){u(c.length-d)&&m()}function x(a){return"string"==typeof a?(a=a.charCodeAt(),a>="A".charCodeAt()&&a<="Z".charCodeAt()||a>="a".charCodeAt()&&a<="z".charCodeAt()||a>="0".charCodeAt()&&a<="9".charCodeAt()):!1}function m(){var a=c;if(0<d&&""==a)var b=X;else if(d==c.length)b=F(a)+
X;else{b=a.substring(0,d);var f=a.substring(d,d+1);f&&(f='<span class="jquery-console-cursor">'+F(f)+"</span>");a=a.substring(d+1);b=F(b)+f+F(a)}I.html(b);J()}function F(a){return a.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/</g,"&lt;").replace(/ /g,"&nbsp;").replace(/\n/g,"<br />")}var L={37:E,39:D,38:R,40:S,8:function(){u(-1)&&(A(),m())},46:T,35:W,36:V,13:function(){var a=c;"function"==typeof e.commandValidate?(a=e.commandValidate(a),1==a||0==a?a&&U():q(a,"jquery-console-message-error")):
U()},18:function(){},9:function(){if("function"==typeof e.completeHandle){var a=e.completeHandle(c),b=a.length;if(1===b)k.promptText(c+a[0]);else if(1<b&&e.cols){for(var f=c,p=0,n=0;n<b;n++)p=Math.max(p,a[n].length);p+=2;var da=Math.floor(e.cols/p),G="",Y=0;for(n=0;n<b;n++){var H=a[n];G+=a[n];for(H=H.length;H<p;H++)G+=" ";++Y>=da&&(G+="\n",Y=0)}q(G,"jquery-console-message-value");k.promptText(f)}}}},M={65:V,69:W,68:T,78:S,80:R,66:E,70:D,75:function(){for(;A();)m()}};e.ctrlCodes&&h.extend(M,e.ctrlCodes);
var Z={70:function(){for(;d<c.length&&!x(c[d])&&D(););for(;d<c.length&&x(c[d])&&D(););},66:function(){for(;0<=d-1&&!x(c[d-1])&&E(););for(;0<=d-1&&x(c[d-1])&&E(););},68:function(){for(;d<c.length&&!x(c[d]);)A(),m();for(;d<c.length&&x(c[d]);)A(),m()}},aa={13:function(){var a="\n"+c.split("\n").slice(-1)[0].match(/^(\s*)/g)[0];c+=a;u(a.length);m()}},X='<span class="jquery-console-cursor">&nbsp;</span>',N=h(this),g=h('<div class="jquery-console-inner"></div>'),l=h('<textarea autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" class="jquery-console-typer"></textarea>'),
y,I,ba=e&&e.continuedPromptLabel?e.continuedPromptLabel:"> ",d=0,c="",C="",w="",ea=void 0!==e.fadeOnReset?e.fadeOnReset:!0,z=[],r=0,t=0,B=!0,k={};(function(){k.promptLabel=e&&e.promptLabel?e.promptLabel:"> ";N.append(g);g.append(l);l.css({position:"absolute",top:0,left:"-9999px"});e.welcomeMessage&&K(e.welcomeMessage,"jquery-console-welcome");v();e.autofocus&&(g.addClass("jquery-console-focus"),l.focus(),setTimeout(function(){g.addClass("jquery-console-focus");l.focus()},100));k.inner=g;k.typer=l;
k.scrollToBottom=J;k.report=ca})();k.reset=function(){var a="undefined"!=typeof e.welcomeMessage,b=function(){g.find("div").each(function(){a?a=!1:h(this).remove()})};ea?g.parent().fadeOut(function(){b();v();g.parent().fadeIn(O)}):(b(),v(),O())};var O=function(){g.addClass("jquery-console-focus");l.focus()};k.focus=function(){O()};k.notice=function(a,b){var f=h('<div class="notice"></div>').append(h("<div></div>").text(a)).css({visibility:"hidden"});N.append(f);var p=!0;if("fadeout"==b)setTimeout(function(){f.fadeOut(function(){f.remove()})},
4E3);else if("prompt"==b){var n=h('<br/><div class="action"><a href="javascript:">OK</a><div class="clear"></div></div>');f.append(n);p=!1;n.click(function(){f.fadeOut(function(){f.remove();g.css({opacity:1})})})}n=f.height();f.css({height:"0px",visibility:"visible"}).animate({height:n+"px"},function(){p||g.css({opacity:.5})});f.css("cursor","default");return f};N.click(function(){if(window.getSelection().toString())return!1;g.addClass("jquery-console-focus");g.removeClass("jquery-console-nofocus");
P?l.focusWithoutScrolling():l.css("position","fixed").focus();J();return!1});l.blur(function(){g.removeClass("jquery-console-focus");g.addClass("jquery-console-nofocus")});l.bind("paste",function(a){l.val("");setTimeout(function(){l.consoleInsert(l.val());l.val("")},0)});l.keydown(function(a){t=0;var b=a.keyCode;if(a.ctrlKey&&67==b)return t=b,"function"==typeof e.cancelHandle&&e.cancelHandle(),!1;if(B){if(a.shiftKey&&!a.altKey&&!a.ctrlKey&&b in aa)return t=b,aa[b](),!1;if(a.altKey&&!a.shiftKey&&!a.ctrlKey&&
b in Z)return t=b,Z[b](),!1;if(a.ctrlKey&&!a.shiftKey&&!a.altKey&&b in M)return t=b,M[b](),!1;if(!a.shiftKey&&!a.ctrlKey&&!a.altKey&&b in L)return t=b,L[b](),!1}});l.keypress(function(a){var b=a.keyCode||a.which;if((a.keyCode==L.tab||192==a.keyCode)&&a.altKey)return!1;if((a.ctrlKey||a.metaKey)&&"v"==String.fromCharCode(b).toLowerCase())return!0;if(B&&t!=b&&32<=b){if(t)return!1;("undefined"==typeof e.charInsertTrigger||"function"==typeof e.charInsertTrigger&&e.charInsertTrigger(b,c))&&l.consoleInsert(b)}if(P)return!1});
l.consoleInsert=function(a){a="number"==typeof a?String.fromCharCode(a):a;var b=c.substring(0,d),f=c.substring(d);c=b+a+f;u(a.length);C=c;m()};k.promptText=function(a){"string"===typeof a&&(c=a,d=c.length,m());return c};return k};h.fn.filledText=function(e){h(this).text(e);h(this).html(h(this).html().replace(/\n/g,"<br/>"));return this};h.fn.focusWithoutScrolling=function(){var e=window.scrollX,v=window.scrollY;h(this).focus();window.scrollTo(e,v)}})(jQuery);
